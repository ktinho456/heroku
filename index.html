<html>  
<head>
<style>
#main {
        border:#333;
        border-width:2px;
        border-style:solid;
}


</style>
<script src="socket.io.js"></script>
<script src="jquery.min.js"></script>
<script src="map.js"></script>

<script src="eventos2.js"></script>

<script src="anima.js"></script>
<script type="text/javascript">
	
	
	
	      var socket = io();
      var el = document.getElementById('server-time');

	
	
	
	   socket.on('time', function(timeString) {
        el.innerHTML = 'Server time: ' + timeString;
      });
	
	
	
	
	


	
	

	
	
$(document).ready(function(){
            // no clique do botão (coisa jquery)
                //as coisas dentro desta cláusula acontecer somente quando
              //  o botão é clicado.
            $("button").click(function(){
            
               // apenas registro algumas simples
              // $("p#log").html('sent message: ' + $("input#msg").val());
               
               // enviar mensagem para o servidor em inputbox
               //socket.emit('chat', $("input#msg").val() );
               
                // O servidor receberá a mensagem,
                // Então talvez fazer algum processamento, então ele irá
                // Transmiti-lo novamente. no entanto, não vai
                // Envia para o remetente original. o remetente
                // Será o navegador que envia a msg.
                // Outros navegadores de escuta para o servidor irá
                // Receber a mensagem emitida. Desta forma, pretendemos
                // Necessário imprimir manualmente esta msg para o remetente.
              // $("p#data_recieved").append("<br />\r\n" + name + ': ' + $("input#msg").val());
               
               // então esvaziar o texto na caixa de entrada.
              // $("input#msg").val('');
            });
            
            // pedir o nome do usuário, perguntar de novo se nenhum nome.
            while (name == '') {
               name = prompt("qual é o seu nome?","");
            }
            
			$("p#nickname").append(name)
            // enviar o nome para o servidor, e do servidor
             // Registra espera vai receber isso.
            socket.emit('register', name );
         });
         
         // ouvir para o evento de bate-papo e dados recieve
			socket.on('chat',
				function (data)
				{
					console.log(data)

					$("p#data_recieved").append("<br />\r\n" + data.msgr + ': ' +output);

					//document.getElementById("vy").innerHTML = data.playerX;
					//document.getElementById("vx").innerHTML = data.playerY;
          
         
          
					// nós registramos este evento para se divertir: D
					//  $("p#log").html('got message: ' + data.msg + data.msgr + ': ' + data.playerX);



					//newplayerX = data.playerX;
					//newplayerY = data.playerY;
					//document.getElementById("vy").innerHTML = newplayerX;

          
            
				}
			);



			
			socket.on('position',
				function (data)
				{
					console.log(data)


					$("p#data_recieved").append("<br />\r\n [positions] {" + data.msgr + ": playerX = " + data.playerX + ", playerY = " + data.playerY + "}");
					document.getElementById("vy").innerHTML = playerX;
					document.getElementById("vx").innerHTML = playerY;




					var playerx1 = data.playerX;
					var playery1 = data.playerY;
					var playerxx = data.playerX+1;
					var playeryy = data.playerY+1;
					var playerr = data.playerX-1;
					var playerrr = data.playerY-1;


					objectMap[playerx1][playery1] = 1;

					   if(playerx1 !== playerxx && playery1 !== playeryy){
 					  delete player[playerxx][playeryy];
 					  delete player[playerr][playerrr];
 					  delete player[playerx1][playeryy];
 					  delete player[playerx1][playerrr];

					   delete player[playerxx][playery1];
					   delete player[playerr][playery1];
					   delete player[playerxx][playerrr];
					   delete player[playerr][playeryy];


  }


			


				}
			);

















</script>
</head>
<body onLoad="init();">
<p id="nickname"></p>
<canvas id="main" width="750" height="550" style="margin-top:10px; margin-left:10px;"></canvas



onload="initPage();"
		onunload="exitPage();"
		>

        <div id="l">level >> <span id="lvl"></span></div>
        <div id="p">pontos >> <span id="pts"></span></div>

        <div id="y">posicaox >> <span id="vy"></span></div>
        <div id="y">posicaoy >> <span id="vx"></span></div>
      
 
 <input id ="t"type="text"/>
<input type="boton" value="mostrar" onclick ="mostrarmensagem()"/;>
      
      <p id='server-time'></p>
      <p id="log"></p>
      <p id="data_recieved"></p>
      
   
   </body>
      
</html>
